/*
 * Shorten, a jQuery plugin to automatically shorten text to fit in a block or a pre-set width and configure how the text ends.
 * Copyright (C) 2009-2011  Marc Diethelm
 * License: (GPL 3, http://www.gnu.org/licenses/gpl-3.0.txt) see license.txt
 */

(function(a){a.fn.shorten=function(){var b={},c=arguments,f=c.callee,i={shortened:false,textOverflow:false};if(c.length)if(c[0].constructor==Object)b=c[0];else if(c[0]=="options")return a(this).eq(0).data("shorten-options");else b={width:parseInt(c[0]),tail:c[1]};this.css("visibility","hidden");var g=a.extend({},f.defaults,b);return this.each(function(){var e=a(this),d=e.text(),o=d.length,h,j,k,l=a("<span/>").html(g.tail).text();h=e.css("float")!="none"?g.width||e.width():g.width||e.parent().width(); if(h<0)return true;e.data("shorten-options",g);this.style.display="block";this.style.whiteSpace="nowrap";if(f._supportsCanvas){j=f.measureText_initCanvas.call(this);k=f.measureText_canvas}else{j=f.measureText_initTable.call(this);k=f.measureText_table}var m=k.call(this,d,j);if(m<h){e.text(d);this.style.visibility="visible";e.data("shorten-info",i);return true}g.tooltip&&this.setAttribute("title",d);if(f._native&&!b.width){var r=a("<span>"+g.tail+"</span>").text();if(r.length==1&&r.charCodeAt(0)== 8230){e.text(d);this.style.overflow="hidden";this.style[f._native]="ellipsis";this.style.visibility="visible";i.shortened=true;i.textOverflow="ellipsis";e.data("shorten-info",i);return true}}l=k.call(this,l,j);h-=l;l=h*1.15;if(m-l>0){m=d.substring(0,Math.ceil(o*(l/m)));if(k.call(this,m,j)>h){d=m;o=d.length}}do{o--;d=d.substring(0,o)}while(k.call(this,d,j)>=h);e.html(a.trim(a("<span/>").text(d).html())+g.tail);this.style.visibility="visible";i.shortened=true;e.data("shorten-info",i);return true})}; var n=document.documentElement.style,q=false;if("textOverflow"in n)q="textOverflow";else if("OTextOverflow"in n)q="OTextOverflow";n=document.createElement("canvas");var p=n.getContext("2d");a.fn.shorten._supportsCanvas=p?true:false;delete n;a.fn.shorten._native=q;a.fn.shorten.measureText_initCanvas=function(){var b=a(this),c=document.createElement("canvas");p=c.getContext("2d");b.html(c);p.font=b.css("font-style")+" "+b.css("font-variant")+" "+b.css("font-weight")+" "+Math.ceil(parseFloat(b.css("font-size")))+ "px "+b.css("font-family");return p};a.fn.shorten.measureText_canvas=function(b,c){return c.measureText(b).width};a.fn.shorten.measureText_initTable=function(){var b=a('<table style="padding:0; margin:0; border:none; font:inherit;width:auto;zoom:1;position:absolute;"><tr style="padding:0; margin:0; border:none; font:inherit;"><td style="padding:0; margin:0; border:none; font:inherit;white-space:nowrap;"></td></tr></table>');$td=a("td",b);a(this).html(b);return $td};a.fn.shorten.measureText_table= function(b,c){c.text(b);return c.width()};a.fn.shorten.defaults={tail:"&hellip;",tooltip:true}})(jQuery);
